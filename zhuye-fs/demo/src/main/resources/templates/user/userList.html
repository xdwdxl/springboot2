<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8"/>
    <title>detail.html</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui@2.4.11/lib/index.js"></script>
</head>
<body>
<div id="app">
    <el-container style="height: 730px; ">
        <el-aside width="200px" style="background-color: rgb(250,255,255);border: 1px solid #c0cac9">
            <el-tree :data="data" :props="defaultProps" @node-click="handleNodeClick"></el-tree>
        </el-aside>
        <el-container style=" border: 1px solid #c0cac9;padding-top: 20px">
            <el-header style=" border-bottom: 1px solid #c0cac9;height: 130px">
                <el-form :inline="true" :model="formInline" class="demo-form-inline" >
                    <el-form-item label="用户姓名：">
                        <el-input v-model="formInline.username" placeholder="请输入用户名"></el-input>
                    </el-form-item>
                    <el-form-item>
                        <el-button  @click="search1" type="primary" icon="el-icon-search" plain></el-button>
                        <el-button  type="primary" icon="el-icon-refresh" plain></el-button>
                    </el-form-item>
                </el-form>
                <div>
                    <el-button @click="charu" type="primary" plain>新增</el-button>
                    <!--<el-button @click="xiugai" type="primary" plain>编辑</el-button>-->
                    <el-button @click="del" type="primary" plain>删除</el-button>
                </div>
            </el-header>
            <el-main style="background-color: rgb(250,255,255);">
                <el-table
                        ref="multipleTable"
                        :data="users"
                        stripe
                        border
                        tooltip-effect="dark"
                        style="width: 100%"
                        @selection-change="handleSelectionChange">
                    <el-table-column
                            prop="id"
                            width="50">
                    </el-table-column>
                    <el-table-column
                            type="selection"
                            width="55">
                    </el-table-column>
                    <el-table-column
                            prop="number"
                            label="账号"
                            width="120">
                    </el-table-column>
                    <el-table-column
                            prop="username"
                            label="用户姓名"
                            width="120">
                    </el-table-column>
                    <el-table-column
                            prop="phone"
                            label="手机号"
                            width="150">
                    </el-table-column>
                    <el-table-column
                            prop="establish"
                            label="创建用户"
                            width="150">
                    </el-table-column>
                    <el-table-column
                            prop="mechanism"
                            label="组织机构"
                            width="180">
                    </el-table-column>
                    <el-table-column
                            prop="role"
                            label="角色名称"
                            show-overflow-tooltip>
                    </el-table-column>
                    <el-table-column
                            label=操作
                    >
                        <template slot-scope="scope" >
                            <el-button @click="xiugai(scope)" type="text" size="small">修改</el-button>
                            <el-button @click="del(scope)" type="text" size="small">删除</el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </el-main>
        </el-container>

    </el-container>



    <el-dialog
            title="提示"
            :visible.sync="dialogVisible"
            width="30%"
            :before-close="handleClose">
        <el-form  label-width="80px" :model="formLabelAlign">
            <el-form-item label="id">
                <el-input v-model="formLabelAlign.id"></el-input>
            </el-form-item>
            <el-form-item label="账号">
                <el-input v-model="formLabelAlign.number"></el-input>
            </el-form-item>
            <el-form-item label="用户姓名">
                <el-input v-model="formLabelAlign.username"></el-input>
            </el-form-item>
            <el-form-item label="手机号">
                <el-input v-model="formLabelAlign.phone"></el-input>
            </el-form-item>
            <el-form-item label="创建用户">
                <el-input v-model="formLabelAlign.establish"></el-input>
            </el-form-item>
            <el-form-item label="组织机构">
                <el-input v-model="formLabelAlign.mechanism"></el-input>
            </el-form-item>
            <el-form-item label="角色">
                <el-input v-model="formLabelAlign.role"></el-input>
            </el-form-item>
        </el-form>
        <span slot="footer" class="dialog-footer">
            <el-button @click="handleClose">取 消</el-button>
             <el-button type="primary" @click="cr" v-show="type=='add'">新增</el-button>
            <el-button type="primary" @click="xg" v-show="type=='edit'">修改</el-button>
        </span>
    </el-dialog>
</div>
</body>
<script>
    var vm =  new Vue({
        el:"#app",
        data(){
            return {
                rowData:[],
                type:'',
                search: '',
                username:'',
                dialogVisible:false,
                users:[],
                formInline:{
                    username: '',
                },
                formLabelAlign: {
                    id: '',
                    number: '',
                    username: '',
                    phone: '',
                    establish: '',
                    mechanism: '',
                    role: ''
                },
                multipleSelection: [],
                data: [{
                    label: '朱烨有限责任公司',
                    children: [{
                        label: '超厉害队',
                        children: [{
                            label: '一组'
                        },{
                            label: '二组'
                        }]
                    }, {
                        label: '超漂亮队',
                        children: [{
                            label: '三组'
                        }]
                    }]
                }],
                defaultProps: {
                    children: 'children',
                    label: 'label'
                }
            };
        },
        mounted:function(){
            this.getList()
        },
        methods: {
            getList(){
                let that = this;
                $.get('getDetail',{},function(data){
                    console.log(data);
                    if(data.success){
                        that.users = data.users
                    }
                })
            },
            del(val){
                console.log(val.row.id);
                let id = val.row.id;
                let that = this;
                $.get('delete',{id:id},function(data){
                    console.log(data);
                    if(data=='删除成功'){
                        that.getList()
                    }
                })

            },
            charu(){
                this.type = 'add'
                this.dialogVisible = true
            },
            handleClose(){
                this.dialogVisible = false
                this.formLabelAlign  = {},
                    this.type= ''
            },
            cr(){
                let that = this
                $.get('insert',this.formLabelAlign,function(data){
                    console.log(data)
                    that.dialogVisible = false
                    that.getList()

                })
            },
            xiugai(val){
                this.type = 'edit';
                this.rowData = val.row;
                this.formLabelAlign =this.rowData;
                this.dialogVisible = true
            },
            xg(){
                let that = this;
                console.log(this.formLabelAlign);
                $.get('update',this.formLabelAlign,function(data){
                    console.log(data);
                    if(data=='修改成功'){
                        that.dialogVisible = false;
                        that.getList()
                    }
                })
            },
            search1(){
                let that = this;
                $.get('ListUserByusername',this.formInline,function(data){
                    console.log(data);
                    that.users = data

                })
            },
            handleNodeClick(data) {
                console.log(data);
            },
            handleSelectionChange(row) {
                console.log(row)

            }
        }

    })
</script>
<style>
    .el-aside {
        background-color: #D3DCE6;
        color: #333;
        text-align: center;
        line-height: 200px;
    }

    .el-main {
        background-color: #E9EEF3;
        color: #333;
        text-align: center;

    }

</style>
</html>
